<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GAZADA | Compras</title>
  <link rel="icon" type="image/png" href="images/BANNER_GAZADA_RP.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    @font-face {
      font-family: 'AnotherDanger';
      src: url('fonts/AnotherDanger.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    :root {
      --primary: #c00000;
      --primary-dark: #8f0000;
      --text: #ffffff;
      --muted: #cfcfcf;
      --bg-dark: #000000;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.10);
      --ok: #22c55e;
      --warn: #f59e0b;
    }

    *{ margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
    body{ background:var(--bg-dark); color:var(--text); overflow-x:hidden; }

    .topbar{
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 72px;
      padding: 20px 60px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      z-index: 1000;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
    }

    .logo{
      display: flex;
      align-items: center;
      height: 100%;
      margin-left: -50px;
    }
    .logo img{
      max-height: 160px;
      width: auto;
      object-fit: contain;
    }

    .nav ul{ display:flex; gap:26px; list-style:none; align-items:center; margin:0; padding:0; }

    .nav a{
      text-decoration:none; color:#fff; font-weight:500; font-size:14px;
      position:relative; padding:5px 0; transition:color .3s ease;
    }
    .nav a::after{
      content:""; position:absolute; left:0; bottom:-6px;
      width:0; height:2px; background:var(--primary);
      transition:width .3s ease;
    }
    .nav a:hover{ color:var(--primary); }
    .nav a:hover::after{ width:100%; }

    .btn-download{
      padding: 10px 22px;
      border: 1px solid var(--primary);
      color: var(--primary);
      border-radius: 30px;
      text-decoration: none;
      font-size: 13px;
      transition: all .3s ease;
    }
    .btn-download:hover{
      background: var(--primary);
      color: #fff;
      box-shadow: 0 0 15px rgba(192,0,0,0.6);
    }

    .dropdown{ position:relative; }
    .dropbtn{
      text-decoration:none;
      color:#fff;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 2px;
    }
    .caret{
      width:10px; height:10px;
      border-right:2px solid #ff3b3b;
      border-bottom:2px solid #ff3b3b;
      transform:rotate(45deg);
      opacity:0;
      transition:opacity .15s ease, transform .18s ease;
    }
    .dropdown-menu{
      position:absolute;
      top:38px;
      left:50%;
      transform:translateX(-50%) translateY(-8px);
      min-width:210px;
      background:#fff;
      border-radius:14px;
      padding:12px;
      box-shadow:0 18px 40px rgba(0,0,0,.35);

      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transition:opacity .18s ease, transform .18s ease, visibility .18s ease;
    }
    .dropdown-menu a{
      display:block;
      padding:10px 12px;
      border-radius:10px;
      color:#1a1a1a;
      text-decoration:none;
      font-weight:500;
    }
    .dropdown-menu a:hover{ background:rgba(0,0,0,.06); }
    .dropdown:hover .dropbtn{ color:#ff3b3b; }
    .dropdown:hover .caret{ opacity:1; }
    .dropdown:hover .dropdown-menu{
      opacity:1;
      visibility:visible;
      pointer-events:auto;
      transform:translateX(-50%) translateY(0);
    }

    .page{
      min-height: 100vh;
      padding: 120px 20px 0;
      position:relative;
      display: flex;
      flex-direction: column;
      background:
        radial-gradient(900px 420px at 50% 10%, rgba(192,0,0,.26), rgba(0,0,0,0) 60%),
        linear-gradient(rgba(0,0,0,.78), rgba(0,0,0,.92)),
        url('vips-bg.jpg') center/cover no-repeat;
    }

    .blob{
      position:absolute;
      width:380px; height:380px;
      border-radius:999px;
      filter: blur(60px);
      opacity:.18;
      pointer-events:none;
      animation: floaty 7s ease-in-out infinite;
      background: rgba(192,0,0,.9);
    }
    .blob.b1{ top: 110px; left: -140px; }
    .blob.b2{ bottom: 70px; right: -160px; animation-delay: 1.1s; opacity:.14; }
    @keyframes floaty{
      0%,100%{ transform: translate(0,0); }
      50%{ transform: translate(14px,-10px); }
    }

    .wrap{
      width: min(1180px, 100%);
      margin: 0 auto;
      position: relative;
      flex: 1;
    }

    .kicker{
      display:inline-block;
      font-size: 12px;
      letter-spacing: 4px;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .title{
      font-family:'AnotherDanger', sans-serif;
      font-size: 64px;
      color:#ff2a2a;
      letter-spacing: 2px;
      line-height: 1;
      text-transform:uppercase;
      text-shadow: 0 0 6px rgba(255,0,0,.45), 0 0 16px rgba(255,0,0,.25);
      margin-bottom: 10px;
    }

    .subtitle{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.9;
      max-width: 820px;
      margin-bottom: 26px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 18px;
      align-items:start;
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 18px 40px rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
      transform: translateY(10px);
      opacity: 0;
      transition: transform .55s ease, opacity .55s ease;
    }
    .card.reveal{ transform: translateY(0); opacity: 1; }

    .card h2{
      font-size: 16px;
      letter-spacing: .3px;
      margin-bottom: 14px;
    }

    .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom: 12px; }
    label{ font-size: 12px; color: rgba(255,255,255,.78); letter-spacing:.4px; }
    input, select{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: #fff;
      outline: none;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    input:focus, select:focus{
      border-color: rgba(192,0,0,.65);
      box-shadow: 0 0 0 3px rgba(192,0,0,.18);
    }

    .hint{
      font-size: 12px;
      color: rgba(255,255,255,.60);
      line-height: 1.6;
      margin-top: 4px;
    }

    .note-wrap{
      display:flex;
      gap:10px;
      align-items:stretch;
    }
    .note-wrap input{ flex:1; }
    .copybtn{
      width:auto;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:#fff;
      cursor:pointer;
      transition: transform .2s ease, border-color .2s ease;
      white-space:nowrap;
    }
    .copybtn:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); }

    .pay-methods{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .pay{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 12px;
      cursor:pointer;
      transition: transform .2s ease, border-color .2s ease;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .pay:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); }
    .pay.active{ border-color: rgba(192,0,0,.75); }
    .pay small{ color: rgba(255,255,255,.65); font-size: 12px; }

    .btn{
      width:100%;
      margin-top: 12px;
      padding: 14px 18px;
      border-radius: 999px;
      border: 1px solid var(--primary);
      background: transparent;
      color: var(--primary);
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all .3s ease;
      text-align:center;
      text-decoration:none;
      display:inline-block;
    }
    .btn:hover{
      background: var(--primary);
      color:#fff;
      box-shadow: 0 0 22px rgba(192,0,0,.55);
      transform: translateY(-2px);
    }
    .btn[aria-disabled="true"]{
      opacity:.55;
      pointer-events:none;
      transform:none !important;
      box-shadow:none !important;
    }

    .summary-line{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-size: 13px;
      color: rgba(255,255,255,.88);
    }
    .summary-line:last-child{ border-bottom: none; padding-bottom:0; }
    .muted{ color: rgba(255,255,255,.60); font-size: 12px; }

    .total{
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 12px;
    }
    .total .t{ font-size: 12px; color: rgba(255,255,255,.65); text-transform:uppercase; letter-spacing:1px; }
    .total .v{
      font-size: 28px;
      font-weight: 800;
      letter-spacing: .5px;
      color:#fff;
    }

    .notice{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.85);
      font-size: 12px;
      line-height: 1.7;
    }
    .notice strong{ color: var(--primary); }

    .toast{
      display:none;
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
      font-size: 12px;
      line-height: 1.7;
      white-space: pre-line;
    }
    .toast.ok{ border-color: rgba(34,197,94,.35); }
    .toast.warn{ border-color: rgba(245,158,11,.35); }
    .toast.show{ display:block; animation: pop .25s ease both; }
    @keyframes pop{ from{ opacity:0; transform: translateY(6px); } to{ opacity:1; transform: translateY(0);} }

    footer{
      margin-top: 26px;
      padding: 18px 0 0;
      color: rgba(255,255,255,.55);
      border-top: 1px solid rgba(255,255,255,.08);
      text-align:center;
      font-size: 12px;
    }

    @media (max-width: 1000px){
      .grid{ grid-template-columns: 1fr; }
      .topbar{ padding: 20px 30px; }
      .title{ font-size: 52px; }
    }
    @media (max-width: 600px){
      .nav ul{ display:none; }
      .title{ font-size: 44px; }
      .row{ grid-template-columns: 1fr; }
      .pay-methods{ grid-template-columns: 1fr; }
      .note-wrap{ flex-direction:column; }
      .copybtn{ width:100%; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <a href="index.html" class="logo">
      <img src="images/BANNER_GAZADA_RP.png" alt="GAZADA">
    </a>

    <nav class="nav">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="sobre.html">Sobre</a></li>
        <li class="dropdown">
          <a href="vips.html" class="dropbtn">VIPS <span class="caret"></span></a>
          <div class="dropdown-menu">
            <a href="vips.html#vips">Coins</a>
            <a href="vips.html#vips">Vips mensais</a>
            <a href="vips.html#vips">Vips exclusivos</a>
            <a href="vips.html#vips">Extras</a>
          </div>
        </li>
        <li><a href="compras.html">Compras</a></li>
      </ul>
    </nav>

    <a href="https://discord.gg/YrDsBnj2wb" class="btn-download">Discord</a>
  </header>

  <main class="page">
    <div class="blob b1"></div>
    <div class="blob b2"></div>

    <div class="wrap">
      <span class="kicker">CHECKOUT â€¢ GAZADA</span>
      <h1 class="title">COMPRAS</h1>
      <p class="subtitle">
        Seleciona o produto, preenche os teus dados e finaliza a compra.
        Depois, copia a <strong>Nota para pagamento</strong> e cola nas notas do checkout / ticket no Discord.
      </p>

      <div class="grid">
        <section class="card" id="checkoutCard">
          <h2>Dados do comprador</h2>

          <div class="row">
            <div class="field">
              <label for="name">Nome</label>
              <input id="name" type="text" placeholder="Ex: JoÃ£o Silva" autocomplete="name">
            </div>
            <div class="field">
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="exemplo@email.com" autocomplete="email">
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="discord">Discord (opcional)</label>
              <input id="discord" type="text" placeholder="ex: user#0000 / @user">
              <div class="hint">Recomendado para suporte mais rÃ¡pido.</div>
            </div>
            <div class="field">
              <label for="serverId">ID / Nome no servidor</label>
              <input id="serverId" type="text" placeholder="Ex: Mika / 12345">
              <div class="hint">Para entregarmos o VIP/coins corretamente.</div>
            </div>
          </div>

          <h2 style="margin-top:6px;">Produto</h2>

          <div class="row">
            <div class="field">
              <label for="product">Selecionar</label>
              <select id="product">
                <option value="coins10" data-price="9.99" data-kind="oneshot" data-name="Coins â€” Pack 10">Coins â€” Pack 10 (â‚¬9.99)</option>
                <option value="coins25" data-price="20.99" data-kind="oneshot" data-name="Coins â€” Pack 25">Coins â€” Pack 25 (â‚¬20.99)</option>
                <option value="coins50" data-price="42.99" data-kind="oneshot" data-name="Coins â€” Pack 50">Coins â€” Pack 50 (â‚¬42.99)</option>
                <option value="coins100" data-price="95.99" data-kind="oneshot" data-name="Coins â€” Pack 100">Coins â€” Pack 100 (â‚¬95.99)</option>

                <option value="vip_diamante" data-price="9.90" data-kind="vip" data-name="VIP Mensal â€” Diamante">VIP Mensal â€” Diamante (â‚¬9.90)</option>
                <option value="vip_gazada" data-price="12.50" data-kind="vip" data-name="VIP Mensal â€” Gazada">VIP Mensal â€” Gazada (â‚¬12.50)</option>

                <option value="vip_dezembro" data-price="25.00" data-kind="vip" data-name="VIP Exclusivo â€” Dezembro">VIP Exclusivo â€” Dezembro (â‚¬25.00)</option>

                <option value="extra_galinha" data-price="5.99" data-kind="limited" data-name="Extra â€” Galinha VIP">Extra â€” Galinha VIP (â‚¬50.00)</option>

              </select>
            </div>

            <div class="field">
              <label for="qty">Quantidade</label>
              <input id="qty" type="number" min="1" value="1">
              <div class="hint" id="qtyHint">Para VIP mensal normalmente Ã© 1.</div>
            </div>
          </div>

          <h2 style="margin-top:6px;">Pagamento</h2>
          <div class="pay-methods" id="payMethods">
            <div class="pay active" data-method="card" role="button" tabindex="0">
              <div>
                <strong>CartÃ£o</strong><br>
                <small>Visa / Mastercard</small>
              </div>
              <small class="pick">Selecionado</small>
            </div>

            <div class="pay" data-method="mbway" role="button" tabindex="0">
              <div>
                <strong>MB WAY</strong><br>
                <small>Pagamento manual</small>
              </div>
              <small class="pick">Escolher</small>
            </div>
          </div>

          <div class="field" style="margin-top:14px;">
            <label for="orderNote">Nota para pagamento (copia e cola)</label>
            <div class="note-wrap">
              <input id="orderNote" type="text" readonly>
              <button class="copybtn" id="copyNoteBtn" type="button">Copiar</button>
            </div>
            <div class="hint">CartÃ£o: cola no checkout. MB WAY: cola no ticket no Discord.</div>
          </div>

          <!-- BOTÃƒO PRINCIPAL -->
          <a class="btn" id="payBtn" href="#" target="_blank" rel="noopener" aria-disabled="true">
            Abrir checkout
          </a>

          <div class="toast warn" id="toastWarn"></div>
          <div class="toast ok" id="toastOk"></div>
        </section>

        <aside class="card" id="summaryCard">
          <h2>Resumo</h2>

          <div class="summary-line">
            <span class="muted">Produto</span>
            <span id="sumProduct">â€”</span>
          </div>
          <div class="summary-line">
            <span class="muted">PreÃ§o</span>
            <span id="sumPrice">â‚¬0.00</span>
          </div>
          <div class="summary-line">
            <span class="muted">Quantidade</span>
            <span id="sumQty">1</span>
          </div>
          <div class="summary-line">
            <span class="muted">Taxas</span>
            <span id="sumFees">â‚¬0.00</span>
          </div>

          <div class="total">
            <div class="t">Total</div>
            <div class="v" id="sumTotal">â‚¬0.00</div>
          </div>

          <div class="notice" style="margin-top:14px;">
            <strong>Entrega:</strong> apÃ³s confirmaÃ§Ã£o, o produto serÃ¡ entregue ao <em>ID/Nome</em> indicado.
            Se houver problema, abre ticket no Discord.
          </div>
        </aside>
      </div>

      <!-- MB WAY (sÃ³ aparece depois de clicar em "Pagar por MB WAY") -->
      <div id="mbwayBox" style="display:none; margin-top:12px; padding:12px 14px; border-radius:16px; border:1px solid rgba(255,255,255,.10); background: rgba(0,0,0,.22); font-size:12px; line-height:1.7;">
        <strong style="color:#c00000;">MB WAY</strong><br>
        Paga para o nÃºmero: <strong id="mbwayNumber"></strong><br>
        Titular: <strong id="mbwayName"></strong><br>
        Valor: <strong id="mbwayAmount"></strong><br><br>

        <span style="color:rgba(255,255,255,.75);">
          Depois de pagares na app, clica em <strong>"JÃ¡ paguei"</strong> para copiar a mensagem e abrir o Discord.
        </span>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button class="btn" id="copyBtn" type="button" style="width:auto; padding:12px 18px; border-color:rgba(255,255,255,.18); color:#fff;">Copiar mensagem do ticket</button>
          <button class="btn" id="paidBtn" type="button" style="width:auto; padding:12px 18px;">JÃ¡ paguei (Abrir Discord)</button>
        </div>

        <div class="hint" style="margin-top:8px; color:rgba(255,255,255,.65);">
          No ticket: cola a mensagem e anexa o print/comprovativo MB WAY.
        </div>
      </div>

    </div>

    <footer>
      Â© <span id="year"></span> GAZADA â€¢ Compras
    </footer>
  </main>

  <script>
    // ==============================
    // CONFIG (sÃ³ muda isto)
    // ==============================
    const DISCORD_TICKET_URL = "https://discord.gg/CT2AshEYmp"; // link para o teu servidor/canal/tickets
    const MBWAY_NUMBER = ""; // mete o teu nÃºmero real
    const MBWAY_NAME = "GAZADA RP";     // mete o titular

    // CartÃ£o: mete os links reais aqui (Tebex/Stripe/etc)
    const CHECKOUT_LINKS = {
      coins10:        { card: "#" },
      coins25:        { card: "#" },
      coins50:        { card: "#" },
      coins100:       { card: "#" },
      vip_diamante:   { card: "#" },
      vip_gazada:     { card: "#" },
      vip_dezembro:   { card: "#" },
      extra_galinha:  { card: "#" },
    };

    // ==============================
    // INIT
    // ==============================
    const yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    const revealTargets = document.querySelectorAll("#checkoutCard, #summaryCard");
    const io = new IntersectionObserver((entries) => {
      entries.forEach((e) => { if (e.isIntersecting) e.target.classList.add("reveal"); });
    }, { threshold: 0.15 });
    revealTargets.forEach(el => io.observe(el));

    const eur = (n) => "â‚¬" + Number(n).toFixed(2);

    // Elements
    const productSel = document.getElementById("product");
    const qtyInp = document.getElementById("qty");
    const qtyHint = document.getElementById("qtyHint");
    const payBtn = document.getElementById("payBtn");

    const sumProduct = document.getElementById("sumProduct");
    const sumPrice = document.getElementById("sumPrice");
    const sumQty = document.getElementById("sumQty");
    const sumFees = document.getElementById("sumFees");
    const sumTotal = document.getElementById("sumTotal");

    const toastWarn = document.getElementById("toastWarn");
    const toastOk = document.getElementById("toastOk");

    const orderNote = document.getElementById("orderNote");
    const copyNoteBtn = document.getElementById("copyNoteBtn");

    const payMethods = document.getElementById("payMethods");
    let method = "card";

    // MB WAY
    const mbwayBox = document.getElementById("mbwayBox");
    const mbwayNumberEl = document.getElementById("mbwayNumber");
    const mbwayNameEl = document.getElementById("mbwayName");
    const mbwayAmountEl = document.getElementById("mbwayAmount");
    const copyBtn = document.getElementById("copyBtn");
    const paidBtn = document.getElementById("paidBtn");

    mbwayNumberEl.textContent = MBWAY_NUMBER;
    mbwayNameEl.textContent = MBWAY_NAME;

    // Toasts
    function hideToasts(){
      toastWarn.classList.remove("show");
      toastOk.classList.remove("show");
      toastWarn.textContent = "";
      toastOk.textContent = "";
    }
    function showToast(el, text){
      hideToasts();
      el.textContent = text;
      el.classList.add("show");
      setTimeout(() => el.classList.remove("show"), 3200);
    }

    function isValidEmail(v){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
    }

    function validateRequiredFields(showErrors){
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const serverId = document.getElementById("serverId").value.trim();

      if (!name || !email || !serverId){
        if (showErrors) showToast(toastWarn, "Preenche Nome, Email e ID/Nome no servidor antes de avanÃ§ar.");
        return false;
      }
      if (!isValidEmail(email)){
        if (showErrors) showToast(toastWarn, "Email invÃ¡lido. Ex: exemplo@email.com");
        return false;
      }
      return true;
    }

    function enforceQtyRules(){
  const opt = productSel.selectedOptions[0];
  const kind = opt ? (opt.dataset.kind || "oneshot") : "oneshot";

  // VIP + LIMITED = sÃ³ pode 1
  if (kind === "vip" || kind === "limited"){
    qtyInp.value = "1";
    qtyInp.setAttribute("disabled", "disabled");
    qtyHint.textContent = "Este produto sÃ³ pode ser comprado 1 vez por compra.";
  } else {
    // coins (oneshot normal) = pode escolher quantidade
    qtyInp.removeAttribute("disabled");
    qtyHint.textContent = "Podes comprar mais do que 1 (coins).";
  }
}


    function updateSummary(){
      const opt = productSel.selectedOptions[0];
      const name = opt ? (opt.dataset.name || opt.textContent) : "â€”";
      const price = opt ? Number(opt.dataset.price || 0) : 0;

      const qty = Math.max(1, Number(qtyInp.value || 1));
      const fees = 0;

      sumProduct.textContent = name;
      sumPrice.textContent = eur(price);
      sumQty.textContent = String(qty);
      sumFees.textContent = eur(fees);
      sumTotal.textContent = eur(price * qty + fees);

      // mostra o total na box mbway tambÃ©m
      mbwayAmountEl.textContent = sumTotal.textContent;
    }

    function updateOrderNote(){
      const email = document.getElementById("email").value.trim();
      const serverId = document.getElementById("serverId").value.trim();
      const discord = document.getElementById("discord").value.trim();

      const opt = productSel.selectedOptions[0];
      const item = opt ? opt.value : "-";
      const productName = opt ? (opt.dataset.name || opt.textContent) : "-";
      const qty = Math.max(1, Number(qtyInp.value || 1));
      const total = sumTotal.textContent;

      orderNote.value =
        `GAZADA | item:${item} | produto:${productName} | qty:${qty} | total:${total} | server:${serverId || "-"} | discord:${discord || "-"} | email:${email || "-"} | mÃ©todo:${method}`;
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch{
        return false;
      }
    }

    copyNoteBtn.addEventListener("click", async () => {
      const ok = await copyText(orderNote.value);
      showToast(toastOk, ok ? "Nota copiada âœ…" : "NÃ£o consegui copiar. Copia manualmente.");
    });

    function setMethod(m){
      method = m;

      payMethods.querySelectorAll(".pay").forEach(p => {
        const active = p.dataset.method === m;
        p.classList.toggle("active", active);
        const pick = p.querySelector(".pick");
        if (pick) pick.textContent = active ? "Selecionado" : "Escolher";
      });

      // esconder MBWAY box quando troca mÃ©todo
      mbwayBox.style.display = "none";

      updateCheckoutLink();
      updateOrderNote();
    }

    payMethods.querySelectorAll(".pay").forEach(p => {
      p.addEventListener("click", () => setMethod(p.dataset.method));
      p.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          setMethod(p.dataset.method);
        }
      });
    });

    function setPayDisabled(disabled){
      payBtn.setAttribute("aria-disabled", disabled ? "true" : "false");
      if (disabled){
        payBtn.href = "#";
      }
    }

    function updateCheckoutLink(){
      const opt = productSel.selectedOptions[0];
      if (!opt){
        setPayDisabled(true);
        return;
      }

      // MB WAY: botÃ£o nÃ£o navega â€” sÃ³ mostra instruÃ§Ãµes ao clicar
      if (method === "mbway"){
        payBtn.textContent = "Pagar por MB WAY";
        payBtn.removeAttribute("target");
        payBtn.removeAttribute("href"); // importantÃ­ssimo
        setPayDisabled(false);
        return;
      }

      // CartÃ£o: abre checkout real
      payBtn.textContent = "Abrir checkout";
      payBtn.setAttribute("target", "_blank");

      const map = CHECKOUT_LINKS[opt.value];
      const link = map ? map.card : "#";

      if (!link || link === "#"){
        setPayDisabled(true);
      } else {
        setPayDisabled(false);
        payBtn.href = link;
      }
    }

    function buildTicketMessage(){
      const name = document.getElementById("name").value.trim() || "â€”";
      const email = document.getElementById("email").value.trim() || "â€”";
      const discord = document.getElementById("discord").value.trim() || "â€”";
      const serverId = document.getElementById("serverId").value.trim() || "â€”";

      const opt = productSel.selectedOptions[0];
      const product = opt ? (opt.dataset.name || opt.textContent) : "â€”";
      const qty = Math.max(1, Number(qtyInp.value || 1));
      const total = sumTotal.textContent;

      return [
        "ðŸ“© **COMPROVATIVO MB WAY**",
        `ðŸ‘¤ Nome: ${name}`,
        `ðŸ“§ Email: ${email}`,
        `ðŸ’¬ Discord: ${discord}`,
        `ðŸ†” ID/Nome no servidor: ${serverId}`,
        `ðŸ›’ Produto: ${product} x${qty}`,
        `ðŸ’° Total: ${total}`,
        "",
        `ðŸ“± MB WAY para: ${MBWAY_NUMBER} (${MBWAY_NAME})`,
        "",
        "âœ… Anexo: (coloca aqui o print/comprovativo)"
      ].join("\n");
    }

    // Clique no botÃ£o principal
    payBtn.addEventListener("click", (e) => {
      hideToasts();

      if (!validateRequiredFields(true)){
        e.preventDefault();
        return;
      }

      updateSummary();
      updateOrderNote();

      // MB WAY: mostrar instruÃ§Ãµes (nÃ£o abre link)
      if (method === "mbway"){
        e.preventDefault();
        mbwayBox.style.display = "block";
        mbwayBox.scrollIntoView({ behavior: "smooth", block: "center" });
        showToast(toastOk, "ðŸ“± Paga na app MB WAY e depois clica em Â«JÃ¡ pagueiÂ».");
        return;
      }

      // CartÃ£o: se nÃ£o hÃ¡ link, bloqueia
      if (payBtn.getAttribute("aria-disabled") === "true"){
        e.preventDefault();
        showToast(toastWarn, "Checkout ainda nÃ£o configurado.\nTroca os links em CHECKOUT_LINKS.");
        return;
      }

      showToast(toastOk, "Antes de pagar: copia a Â«Nota para pagamentoÂ» âœ…");
      // deixa abrir a tab
    });

    copyBtn.addEventListener("click", async () => {
      updateSummary();
      updateOrderNote();
      const msg = buildTicketMessage();
      const ok = await copyText(msg);
      showToast(toastOk, ok ? "Mensagem do ticket copiada âœ…" : "NÃ£o consegui copiar. Copia manualmente.");
    });

    paidBtn.addEventListener("click", async () => {
      if (!validateRequiredFields(true)) return;

      updateSummary();
      updateOrderNote();

      // copia a mensagem automaticamente
      const msg = buildTicketMessage();
      const ok = await copyText(msg);
      showToast(toastOk, ok ? "Mensagem copiada âœ… A abrir Discord..." : "A abrir Discord... (copia manualmente se necessÃ¡rio)");

      // abre discord
      window.open(DISCORD_TICKET_URL, "_blank");
    });

    function onProductChange(){
      enforceQtyRules();
      updateSummary();
      updateOrderNote();
      updateCheckoutLink();
    }

    productSel.addEventListener("change", onProductChange);
    qtyInp.addEventListener("input", () => {
      qtyInp.value = String(Math.max(1, Number(qtyInp.value || 1)));
      onProductChange();
    });

    ["name","email","serverId","discord"].forEach(id => {
      document.getElementById(id).addEventListener("input", () => {
        updateOrderNote();
      });
    });

function preselectFromUrl(){
  const params = new URLSearchParams(window.location.search);
  const item = params.get("item");

  if (!item) return;

  // Se existir no select, seleciona
  const exists = [...productSel.options].some(o => o.value === item);
  if (exists){
    productSel.value = item;
  }
}

// Init
preselectFromUrl();   // âœ… vai buscar o item vindo do vips.html
onProductChange();
setMethod(method);



  </script>
</body>
</html>
